<% layout('layout/page') -%>
<% block('title', "Регистрация и вход"); -%>
<p class="lead">Введите имя пользователя и пароль, если такого пользователя нет- он будет создан</p>
<form class="form-horizontal login-form" name="login-form">
	<div class="form-group">
		<div class="col-lg-10">
			<label for="input-username" class="control-label">Имя</label>
			<input type="username" value="name" type="text" placeholder="username" class="form-control">
		</div>
	</div>
	<div class="form-group">
		<div class="col-lg-10">
			<label for="input-password" class="control-label">Пароль</label>
			<input type="password" value="password" class="form-control">
		</div>
	</div>
	<div class="form-group">
		<button type="submit" class="btn btn-primary" data-loading-text="Отправляю...">Войти</button>
		<span class="help-block error"></span>
	</div>
</form>
<script>
	//при событии submit
	$(document.forms['login-form']).on('submit',function() {
		var form = $(this);
		$('.error',form).html('');
		$(":submit", form).button("loading");
		//отправка на сервер
		$.ajax({
			url: "/login",
			method: "POST",
			data: form.serialize().
			complete: function() {
				$("submit", form).button("reset");
			},
			statusCode: {
				200: function() {
					form.html("Вы вошли на сайт").addClass('alert-success');
					window.location.href = "/chat";
				},
				403: function(jqXHR) {
					var error = JSON.parse(jqXHR.responseText);
					$('.error',form).html(error.message);
				}
			}
		});
		return false;
	});
</script>
	</div>
	</div>